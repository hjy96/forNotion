<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>CI/CD Pipeline Architecture | Portfolio</title>

    <style>
        :root {
            --bg: #f6f7fb;
            --card: #ffffff;
            --line: #e5e7eb;
            --text: #111827;
            --sub: #475569;
            --accent: #2563eb;
            --code-bg: #0f172a;
            --code-text: #e5e7eb;
        }

        * { box-sizing: border-box; }

        body {
            margin: 0;
            background: var(--bg);
            color: var(--text);
            font-family: -apple-system, BlinkMacSystemFont, Pretendard, Inter, Arial, sans-serif;
            line-height: 1.65;
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 48px 20px 80px;
        }

        h1 { font-size: 28px; margin-bottom: 8px; }
        h2 { margin: 42px 0 14px; font-size: 22px; border-left: 5px solid var(--accent); padding-left: 14px; }
        h3 { margin: 22px 0 10px; font-size: 16px; color: var(--sub); }

        p { margin: 6px 0 14px; color: #374151; }

        .badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 999px;
            background: #eef2ff;
            color: var(--accent);
            font-size: 12px;
            font-weight: 600;
            margin-right: 6px;
        }

        .card {
            background: var(--card);
            border: 1px solid var(--line);
            border-radius: 16px;
            padding: 16px 18px;
            margin-bottom: 18px;
        }

        pre {
            background: var(--code-bg);
            color: var(--code-text);
            border-radius: 12px;
            padding: 16px;
            font-size: 13px;
            overflow-x: auto;
        }

        ul { padding-left: 18px; }

        footer {
            margin-top: 60px;
            padding-top: 24px;
            border-top: 1px solid var(--line);
            color: #475569;
            font-size: 14px;
        }
    </style>
</head>

<body>
<div class="container">

    <span class="badge">CI/CD</span>
    <span class="badge">Kubernetes</span>
    <span class="badge">Gabia Cloud</span>
    <span class="badge">On-Premise</span>

    <h1>CI/CD 파이프라인 설계 및 구축</h1>
    <p>
        사내망 환경에서 <b>빌드 → 배포 → 롤백</b>까지 포함한
        운영 중심 CI/CD 파이프라인을 설계·구축했습니다.
    </p>

    <h2>1. Dockerfile 설계 (보안 · 운영 기준)</h2>
    <div class="card">
        <p>
            컨테이너는 <b>root 계정으로 실행하지 않도록</b> 구성하여
            보안 리스크를 최소화했습니다.
        </p>
        <pre>
FROM node:22-alpine AS runner

RUN addgroup --system --gid 1001 nodejs \
 && adduser --system --uid 1001 nodejs

USER nodejs

EXPOSE 20010
ENV PORT=20010

HEALTHCHECK \
  CMD wget -q -O- http://127.0.0.1:20010/api/healthz || exit 1

CMD ["node", "/app/dist/app.cjs"]
    </pre>
        <ul>
            <li>Non-root 실행으로 권한 상승 공격 방지</li>
            <li>Healthcheck 내장으로 배포 안정성 확보</li>
        </ul>
    </div>

    <h2>2. Jenkins 환경 변수 설계</h2>
    <div class="card">
        <p>
            Jenkins Pipeline에서는 <b>환경별 설정을 환경 변수로 명확히 분리</b>하여
            파이프라인 재사용성과 가독성을 확보했습니다.
        </p>
        <pre>
environment {
  DOCKER_PROJECT = "example"
  IMAGE_NAME     = "backend"
  IMAGE_TAG      = "${BRANCH_NAME == 'main' ? 'latest' : BRANCH_NAME}"

  K8S_NAMESPACE  = "service"
  DEPLOYMENT    = "backend-api"
}
    </pre>
        <ul>
            <li>브랜치 → 이미지 태그 자동 매핑</li>
            <li>환경별 배포 대상 분리</li>
        </ul>
    </div>

    <h2>3. 버전 관리 스크립트 (VERSION 단일 기준)</h2>
    <div class="card">
        <p>
            <code>VERSION</code> 파일을 <b>Single Source of Truth</b>로 사용하여
            배포 버전을 일관되게 관리했습니다.
        </p>
        <pre>
# patch / minor / major 중 선택
yarn version:patch

# 내부 동작
- VERSION 파일 업데이트
- Git Commit (Deploy: x.y.z)
- Git Tag 생성
- 선택적 git push
    </pre>
        <ul>
            <li>개발자가 의도를 가지고 버전 생성</li>
            <li>자동 증가로 인한 배포 사고 방지</li>
        </ul>
    </div>

    <h2>4. 운영 환경 배포 스크립트 (Blue / Green)</h2>
    <div class="card">
        <p>
            운영 환경에서는 <b>Blue / Green 배포 스크립트</b>를 통해
            신규 버전을 기존 서비스와 분리하여 배포했습니다.
        </p>
        <pre>
# 신규 환경(Green) 컨테이너 실행
docker run -d --name backend-green \
  --health-cmd "wget -q -O- http://127.0.0.1:20010/api/healthz || exit 1" \
  backend:x.y.z

# 헬스 체크 성공 후
# 프록시 설정 변경 → 트래픽 전환
caddy reload
    </pre>
        <ul>
            <li>신규 버전 검증 후 트래픽 전환</li>
            <li>운영 중 무중단 배포</li>
        </ul>
    </div>

    <h2>5. 운영 환경 수동 롤백 절차</h2>
    <div class="card">
        <p>
            CI/CD 장애 또는 긴급 상황에 대비하여
            <b>운영 서버에서 직접 실행 가능한 롤백 절차</b>를 마련했습니다.
        </p>
        <pre>
ssh production-server
su - deploy
./backend.sh x.y.z
    </pre>
        <ul>
            <li>Jenkins 장애 시에도 복구 가능</li>
            <li>트래픽 스위치 기반 즉시 복원</li>
        </ul>
    </div>

    <footer>
        <b>요약</b><br/>
        Docker 보안 실행, 명시적 버전 관리, Blue / Green 배포와
        수동 롤백 절차를 포함한
        운영 중심 CI/CD 파이프라인을 구축·운영했습니다.
    </footer>

</div>
</body>
</html>
